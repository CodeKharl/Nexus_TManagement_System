#!/usr/bin/env bash

error_exit() {
    message=$1
    echo "$message" >&2
    exit 1
}

SRC_DIR='src'

BUILD_DIR='build'
JAVAC_FLAGS=(-d "$BUILD_DIR")

BIN_DIR='bin'
JAR_PATH="$BIN_DIR/Nexus.jar"
MANIFEST_PATH='META-INF/MANIFEST.MF'

JAR_FLAGS=(cfm "$JAR_PATH" "$MANIFEST_PATH" -C "$BUILD_DIR" .)

mkdir "$BUILD_DIR" "$BIN_DIR" "${MANIFEST_PATH%/*}" 2>/dev/null

SOURCES=()
while read -r src; do
    SOURCES+=("$src")
done < <(find "$SRC_DIR" -name '*.java')

: "${SOURCES[@]:?'no java file found.'}"

javac "${JAVAC_FLAGS[@]}" "${SOURCES[@]}" || echo 'failed to build classes.'
jar "${JAR_FLAGS[@]}" || echo 'failed to create the jar.'

echo 'Build successfully!'
